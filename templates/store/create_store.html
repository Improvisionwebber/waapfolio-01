{% extends "base.html" %}

{% block title %}
CREATE YOUR WAAP FOLIO STORE
{% endblock title %}

{% load static %}
{% load widget_tweaks %}

{% block body %}

<!-- CSS for intl-tel-input -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/css/intlTelInput.css" />

<form method="POST" enctype="multipart/form-data" class="form" style="padding-bottom: 80px;">
    {% csrf_token %}

    <p>
        {{ form.brand_name.label_tag }}
        {{ form.brand_name }}
        {{ form.brand_name.errors }}
    </p>

    <p>
        <!-- Live preview of brand logo -->
        <label>Brand Logo Preview:</label><br>
        <img id="logo-preview"
             src="{{ form.instance.brand_logo|default:'' }}"
             alt="Logo Preview"
             style="max-width:200px; border-radius:8px; margin-bottom:10px;"
             {% if not form.instance.brand_logo %}hidden{% endif %}>
        <br>
        {{ form.brand_logo.label_tag }}
        {{ form.brand_logo }}
        {{ form.brand_logo.errors }}
    </p>

    <p>
        {{ form.whatsapp_number.label_tag }}
        {{ form.whatsapp_number }}
        {{ form.whatsapp_number.errors }}
    </p>


    <!-- Select Order System -->
    <p>
        <label for="id_order_system">Choose Order System:</label>
        <select id="id_order_system" name="order_system" class="form-control">
            <option value="whatsapp" {% if form.instance.order_system == 'whatsapp' %}selected{% endif %}>WhatsApp</option>
            <option value="facebook" {% if form.instance.order_system == 'facebook' %}selected{% endif %}>Facebook</option>
            <option value="tiktok" {% if form.instance.order_system == 'tiktok' %}selected{% endif %}>TikTok</option>
            <option value="depop" {% if form.instance.order_system == 'depop' %}selected{% endif %}>Depop</option>
        </select>
    </p>

    <!-- WhatsApp number input -->
    <p id="whatsapp-field" style="display: none;">
        {{ form.whatsapp_number.label_tag }}
        {{ form.whatsapp_number }}
        {{ form.whatsapp_number.errors }}
    </p>

    <!-- Facebook link input -->
    <p id="facebook-field" style="display: none;">
        <label>Facebook Page Link:</label>
        <input type="url" name="facebook_link" class="form-control" value="{{ form.instance.facebook_link|default_if_none:'' }}">
    </p>

    <!-- TikTok link input -->
    <p id="tiktok-field" style="display: none;">
        <label>TikTok Profile Link:</label>
        <input type="url" name="tiktok_link" class="form-control" value="{{ form.instance.tiktok_link|default_if_none:'' }}">
    </p>

    <!-- Depop link input -->
    <p id="depop-field" style="display: none;">
        <label>Depop Profile Link:</label>
        <input type="url" name="depop_link" class="form-control" value="{{ form.instance.depop_link|default_if_none:'' }}">
    </p>
    <p>
        {{ form.Bio.label_tag }}
        {{ form.Bio }}
        {{ form.Bio.errors }}
    </p>
    <p>
    {{ form.dob.label_tag }}<small class="text-muted">(YYYY-MM-DD)</small>
    {{ form.dob }}
    {{ form.dob.errors }}
</p>

<p>
    {{ form.address.label_tag }}
    {{ form.address }}
    {{ form.address.errors }}
</p>

<p>
    {{ form.business_type.label_tag }}
    {{ form.business_type }}
    {{ form.business_type.errors }}
</p>
<p>
    {{ form.background_color.label_tag }}
    {{ form.background_color }}
    {{ form.background_color.errors }}
</p>

<p>
    {{ form.social.label_tag }}<small class="text-muted">(optional)</small>
    <input type="url" name="{{ form.social.name }}" class="form-control" placeholder="Enter a link" value="{{ form.social.value|default_if_none:'' }}">
    {{ form.social.errors }}
</p>



    <button type="submit" class="btn btn-primary">
        {% if form.instance.pk %}
            Save Changes
        {% else %}
            Create Store
        {% endif %}
    </button>
</form>

<!-- JS for intl-tel-input -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/intlTelInput.min.js"></script>
<script>
    const phoneInput = document.querySelector("#phone");
    const iti = window.intlTelInput(phoneInput, {
        initialCountry: "ng",
        preferredCountries: ["ng", "us", "gb"],
        separateDialCode: false,
        nationalMode: false,
        formatOnDisplay: false,
        autoHideDialCode: false,
        utilsScript: "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js"
    });

    function keepFullNumber() {
        const fullNumber = iti.getNumber();
        if (fullNumber) {
            phoneInput.value = fullNumber;
        }
    }

    phoneInput.addEventListener("blur", keepFullNumber);
    document.addEventListener("DOMContentLoaded", keepFullNumber);
    document.querySelector("form").addEventListener("submit", function () {
        keepFullNumber();
    });

    // Live preview for brand logo
    const logoInput = document.querySelector('#id_brand_logo');
    const logoPreview = document.querySelector('#logo-preview');

    logoInput.addEventListener('change', function(event) {
        const file = event.target.files[0];
        if(file){
            const reader = new FileReader();
            reader.onload = function(e){
                logoPreview.src = e.target.result;
                logoPreview.hidden = false;
            }
            reader.readAsDataURL(file);
        }
    });
        // Show/hide order fields based on selection
    const orderSelect = document.getElementById('id_order_system');
    const whatsappField = document.getElementById('whatsapp-field');
    const facebookField = document.getElementById('facebook-field');
    const tiktokField = document.getElementById('tiktok-field');
    const depopField = document.getElementById('depop-field');

    function toggleOrderFields() {
        const val = orderSelect.value;
        whatsappField.style.display = (val === 'whatsapp') ? 'block' : 'none';
        facebookField.style.display = (val === 'facebook') ? 'block' : 'none';
        tiktokField.style.display = (val === 'tiktok') ? 'block' : 'none';
        depopField.style.display = (val === 'depop') ? 'block' : 'none';
    }

    orderSelect.addEventListener('change', toggleOrderFields);
    document.addEventListener('DOMContentLoaded', toggleOrderFields);

</script>

<style>
    form p {
        margin-bottom: 20px;
    }

    form p label {
        display: block;
        font-weight: bold;
        margin-bottom: 6px;
        font-size: 14px;
        color: #333;
    }

    form p input,
    form p select,
    form p textarea {
        width: 100%;
        padding: 12px;
        border: 1px solid #ccc;
        border-radius: 8px;
        font-size: 14px;
        transition: border-color 0.3s;
    }
</style>

{% endblock %}
