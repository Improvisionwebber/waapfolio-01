{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/x-icon" href="{% static "images/logo-bg.png" %}">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WAAP FOLIO {% block title %}{% endblock title %}</title>
     {% block head %}{% endblock head %}
    <!-- CSS -->
    <link rel="stylesheet" href="{% static 'css/main.css' %}">
    <link rel="stylesheet" href="{% static 'css/bootstrap.css' %}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-..." crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    {% block meta %}
    <meta property="og:title" content="{{ store.brand_name }} | Waapfolio" />
    <meta property="og:description" content="{{ store.Bio|truncatewords:20 }}" />
    <meta property="og:image" content="{% if store.brand_logo %}{{ store.brand_logo.url }}{% elif store.brand_logo_url %}{{ store.brand_logo_url }}{% else %}{% static 'images/logo.png' %}{% endif %}" />
    <meta property="og:url" content="{{ request.build_absolute_uri }}" />
    <meta property="og:type" content="website" />
    <meta property="og:site_name" content="Waapfolio" />
    {% endblock %}


  <style>
    /* Hide header navbar on mobile */
    @media(max-width: 767px) {
        .navbar {
            display: none !important;
        }
    }

    /* Bottom nav for mobile */
    .mobile-bottom-nav {
      position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        background: #198754; /* bootstrap success color */
        display: flex;
        justify-content: space-around;
        align-items: center;
        z-index: 1050;
        padding-bottom: env(safe-area-inset-bottom);
    }


    .mobile-bottom-nav a {
        color: white;
        text-align: center;
        font-size: 0.9rem;
    }

    .mobile-bottom-nav a:hover {
        text-decoration: none;
        color: #d4edda;
    }

    @media(min-width: 768px){
        .mobile-bottom-nav {
            display: none;
        }
    }
body.dark {
  background-color: #121212 !important;
  color: #eee !important;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  transition: background-color 0.3s, color 0.3s;
}

/* Text colors for headings */
body.dark h1,
body.dark h2,
body.dark h3,
body.dark h4,
body.dark h5,
body.dark h6 {
  color: #eee !important;
}

/* Paragraphs */
body.dark p {
  color: #eee !important;
}

/* Muted and primary text */
body.dark p.text-muted {
  color: #bbb !important;
}
body.dark p.text-primary {
  color: #9ccaff !important; /* lighter blue for contrast */
}

/* Links */
body.dark a.text-dark,
body.dark a.text-decoration-none {
  color: #8cc4ff !important;
}
body.dark a.text-decoration-none:hover {
  color: #b3d1ff !important;
}

/* Buttons */
body.dark a.btn-primary,
body.dark a.btn-success,
body.dark .btn-primary,
body.dark .btn-success {
  color: #fff !important;
  border-color: transparent !important;
}
body.dark .btn-success {
  background-color: #198754 !important; /* keep green */
}
body.dark .btn-primary {
  background-color: #007bff !important; /* blue */
}

/* Containers */
body.dark .container {
  background-color: #1e1e1e !important;
  border-radius: 0.5rem;
  box-shadow: 0 4px 8px rgba(255 255 255 / 0.1);
  padding: 1.5rem;
  color: #eee !important;
}

/* Override all text inside container */
body.dark .container *,
body.dark .container p,
body.dark .container li {
  color: #eee !important;
}

/* Lists */
body.dark ol,
body.dark ul {
  padding-left: 1.5rem;
}
body.dark li {
  margin-bottom: 0.5rem;
  color: #eee !important;
}

/* Cards */
body.dark .card {
  background-color: #1e1e1e !important;
  color: #eee !important;
  box-shadow: 0 0 10px rgba(255 255 255 / 0.1) !important;
}
body.dark .card-text,
body.dark .card-title {
  color: #eee !important;
}
body.dark .card img {
  border: 1px solid #333;
  border-radius: 8px;
}

/* Hero text */
body.dark .hero-txt,
body.dark .hero-txt1,
body.dark .hero-txt2 {
  color: #eee !important;
}

/* Accordion */
body.dark .accordion-button {
  background-color: #1e1e1e !important;
  color: #eee !important;
  border-color: #333 !important;
}
body.dark .accordion-button:not(.collapsed) {
  background-color: #2a2a2a !important;
  color: #fff !important;
}
body.dark .accordion-collapse {
  background-color: #1e1e1e !important;
  color: #eee !important;
}

/* Offcanvas bottom menu */
body.dark .offcanvas.offcanvas-bottom {
  background-color: #121212 !important;
  color: #eee !important;
  border-top: 1px solid #333;
}
body.dark .offcanvas.offcanvas-bottom .offcanvas-header {
  border-bottom: 1px solid #333;
}
body.dark .offcanvas.offcanvas-bottom .offcanvas-title {
  color: #4da6ff !important;
}
body.dark .offcanvas.offcanvas-bottom .btn-close {
  filter: invert(1);
}
body.dark .offcanvas.offcanvas-bottom .list-group-item {
  background-color: transparent !important;
  color: #eee !important;
  border: none;
}
body.dark .offcanvas.offcanvas-bottom .list-group-item:hover {
  background-color: #222 !important;
  color: #fff !important;
}

/* Buttons with outline */
body.dark .btn-outline-primary {
  color: #4da6ff !important;
  border-color: #4da6ff !important;
}
body.dark .btn-outline-primary:hover {
  background-color: #4da6ff !important;
  color: #fff !important;
}
body.dark .btn-outline-success {
  color: #4caf50 !important;
  border-color: #4caf50 !important;
}
body.dark .btn-outline-success:hover {
  background-color: #4caf50 !important;
  color: #fff !important;
}
/* Only affects this testimonial in dark mode */
body.dark .testimonial-green p,
body.dark .testimonial-green strong {
  color: #28a745 !important; /* green for dark mode */
}
/* Dark mode navbar */
body.dark .navbar,
body.dark .navbar-collapse,
body.dark .offcanvas {
  background-color: #121212 !important; /* very dark background */
  color: #eee !important;
}

/* Navbar links */
body.dark .navbar a,
body.dark .navbar .nav-link {
  color: #eee !important;
}

body.dark .navbar a:hover,
body.dark .navbar .nav-link:hover {
  color: #f8f8f9ff !important; /* optional highlight on hover */
}

/* Navbar toggler button */
body.dark .navbar-toggler {
  border-color: #eee !important;
}

body.dark .navbar-toggler-icon {
  filter: invert(1); /* makes hamburger icon visible in dark mode */
}
body {
    margin-bottom: 100px; /* same as your mobile nav height */
}
/* Kill the "Currently: ..." text and link, keep the file input */
p:has(> a[href*="/media/"]) {
    font-size: 0; /* hide the text */
}

p:has(> a[href*="/media/"]) a {
    display: none !important; /* hide the link */
}

p:has(> a[href*="/media/"])::before {
    content: ""; /* remove 'Currently:' completely */
}

/* Mobile bottom nav dark mode */
body.dark .mobile-bottom-nav {
  background: #1e1e1e !important;  /* dark background */
  border-top: 1px solid #333;
}

body.dark .mobile-bottom-nav a {
  color: #eee !important;
}

body.dark .mobile-bottom-nav a:hover {
  color: #4da6ff !important; /* highlight hover */
}
/* --- DARK MODE FIXES --- */

/* socials pill */
body.dark .social-pill {
  background: #2a2a2a !important;
  border: 1px solid #444 !important;
  color: #fff !important;
}
body.dark .social-pill:hover {
  background: #007bff !important;
  border-color: #007bff !important;
  color: #fff !important;
}

/* WhatsApp share + Contact Seller buttons */
body.dark .btn-success,
body.dark .btn-outline-success {
  background-color: #2a2a2a !important;
  color: #4caf50 !important; /* WhatsApp green */
  border: 1px solid #4caf50 !important;
}
body.dark .btn-success:hover,
body.dark .btn-outline-success:hover {
  background-color: #4caf50 !important;
  color: #fff !important;
}

/* kebab (3-dot) dropdown menu button */
body.dark .dropdown .btn-light {
  background-color: #2a2a2a !important;
  border: 1px solid #444 !important;
}
body.dark .dropdown .btn-light i {
  color: #fff !important;
}

/* dropdown menu container */
body.dark .dropdown-menu {
  background-color: #1e1e1e !important;
  border: 1px solid #333 !important;
}
body.dark .dropdown-menu .dropdown-item {
  color: #eee !important;
}
body.dark .dropdown-menu .dropdown-item:hover {
  background-color: #2a2a2a !important;
  color: #fff !important;
}
/* --- DARK MODE FIXES --- */
body.dark .card {
  background: #1e1e1e;
  border: 1px solid #333;
}

body.dark .card-body h6,
body.dark .card-body p,
body.dark .card-actions span {
  color: #eee !important;
}

/* buttons inside product cards */
body.dark .card-actions button {
  background-color: #2a2a2a !important;
  border: 1px solid #444 !important;
}
body.dark .card-actions button:hover {
  background-color: #3a3a3a !important;
  box-shadow: 0 5px 15px rgba(0,255,0,0.2);
}

/* icons inside the buttons */
body.dark .card-actions i {
  color: #00cc00 !important;  /* WhatsApp green or your accent */
}
/* 🌙 Dark mode for Add Product form */
body.dark form.form {
  background: #1c1c1c !important;
  color: #f1f1f1 !important;
}

body.dark form.form label,
body.dark form.form h4,
body.dark form.form h2,
body.dark form.form h5 {
  color: #f1f1f1 !important;
}

body.dark .form-control,
body.dark .form-select {
  background: #2a2a2a !important;
  color: #f1f1f1 !important;
  border: 1px solid #444 !important;
}

body.dark .form-control::placeholder {
  color: #aaa !important;
}

body.dark .extra-img-card {
  background: #2a2a2a !important;
}
body.dark .container {
  background-color: #1e1e1e !important;
  border-radius: 0.5rem;
  box-shadow: 0 4px 8px rgba(255 255 255 / 0.1);
  padding: 1.5rem;
  color: #eee !important;
}
body.dark .container {
  background-color: #1e1e1e !important;
  color: #eee !important;
}
/* 🌙 Dark mode modals */
body.dark .modal-content {
  --bs-modal-bg: #1e1e1e;
  --bs-modal-color: #eee;
  --bs-modal-border-color: #333;
  --bs-modal-header-border-color: #333;
  --bs-modal-footer-border-color: #333;

  background-color: var(--bs-modal-bg) !important;
  color: var(--bs-modal-color) !important;
  border-color: var(--bs-modal-border-color) !important;
}

body.dark .modal-header,
body.dark .modal-footer {
  background-color: #1e1e1e !important;
  border-color: #333 !important;
}

body.dark .modal-title {
  color: #eee !important;
}

body.dark .btn-close {
  filter: invert(1);
  opacity: .85;
}
/* 🌙 Dark mode for Notifications */
body.dark .list-group-item {
  background-color: #1e1e1e !important;
  color: #4caf50 !important; /* green text */
  border: 1px solid #333 !important;
}

body.dark .list-group-item p {
  color: #4caf50 !important; /* notification message in green */
}

body.dark .list-group-item span {
  color: #9ccaff !important; /* keep time ago in light blue for contrast */
}

.action-buttons form,
.action-buttons a {
  display: inline-flex;
  align-items: center;
}

.action-buttons {
  display: flex;
  justify-content: flex-end; /* or space-between depending on layout */
  align-items: center;
}

    /* ---------- Global Loader ---------- */
    .global-loader {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      background: rgba(0,0,0,0.25);
      z-index: 9999;
    }
    .spinner {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      border: 6px solid rgba(0,0,0,0.1);
      border-top-color: #11b981;
      animation: spin 0.9s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    .search-float-btn {
  position: fixed;
  bottom: 80px; /* move up from bottom nav */
  right: 20px;
  width: 55px;
  height: 55px;
  font-size: 22px;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1050;
}
/* ---------- SAFE SPACING FOR FIXED MOBILE NAV ---------- */
/* tweak these values if your nav height differs */
:root{
  --mobile-bottom-nav-height: 72px; /* height of your mobile-bottom-nav */
  --mobile-top-nav-height: 0px;     /* set >0 if you have a fixed top nav */
}

/* on small screens ensure extra padding so nothing sits under fixed bottom nav */
@media (max-width: 767px) {
  /* ensure the whole page leaves room for bottom nav + safe area */
  html, body {
    padding-bottom: calc(var(--mobile-bottom-nav-height) + env(safe-area-inset-bottom));
    /* for scroll-to-anchor behaviour */
    scroll-padding-bottom: calc(var(--mobile-bottom-nav-height) + env(safe-area-inset-bottom));
  }

  /* give main containers an extra bottom buffer too */
  .container, .main-content, main {
    padding-bottom: calc(var(--mobile-bottom-nav-height) + 1rem);
    margin-bottom: 0; /* avoid double margins */
  }

  /* push floating search button above bottom nav */
  .search-float-btn {
    bottom: calc(var(--mobile-bottom-nav-height) + 18px);
  }

  /* small visual polish */
  .mobile-bottom-nav {
    height: var(--mobile-bottom-nav-height);
    padding-top: 6px;
    padding-bottom: calc(6px + env(safe-area-inset-bottom));
    box-shadow: 0 -6px 18px rgba(0,0,0,0.08);
    z-index: 1060; /* keep above most things */
  }

  /* ensure last rows of grid have breathing room */
  .row.g-3, .search-results-row {
    margin-bottom: calc(var(--mobile-bottom-nav-height) + 1rem);
    padding-bottom: calc(var(--mobile-bottom-nav-height) + env(safe-area-inset-bottom));
  }
}

/* Desktop: smaller bottom padding (if needed) */
@media (min-width: 768px) {
  html, body {
    padding-bottom: 24px;
    scroll-padding-top: 12px;
  }
}

/* Card consistent sizing (already added earlier but keep here centrally) */
.card.flex-fill.h-100 {
  display: flex;
  flex-direction: column;
  min-height: 100%;
}
.card-img-top {
  height: 150px;
  object-fit: contain;
  padding: 10px;
}

/* Optional helper class: add to pages that need extra space */
.add-bottom-safe {
  padding-bottom: calc(var(--mobile-bottom-nav-height) + env(safe-area-inset-bottom)) !important;
}

  </style>
</head>
<body>

{% if messages %}
  <div class="messages">
    {% for message in messages %}
      {% if 'error' in message.tags %}
        <p class="text-danger">{{ message }}</p>
      {% endif %}
    {% endfor %}
  </div>
{% endif %}

  <!-- ---------- Global Loader Overlay ---------- -->
  <div id="globalLoader" class="global-loader">
    <div class="spinner"></div>
  </div>


</head>
<body>
    <div class="bg-success fade-in">
        <nav class="navbar navbar-expand-lg">
            <div class="container-fluid">
                <a class="navbar-brand text-light" href="{% url 'home' %}">WAAP FOLIO</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto align-items-center">
                        <li class="nav-item">
                            <a class="nav-link active text-light" aria-current="page" href="{% url 'home' %}">Home</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link text-light" href="{% url 'about' %}">About</a>
                        </li>
                        {% if user_store %}
                          <li class="nav-item">
                              <a class="nav-link text-light" href="{{ user_store.get_absolute_url }}">Store</a>
                          </li>
                        {% endif %}

                        {% if request.user.is_authenticated %}
                            <li class="nav-item">
                                <a class="nav-link text-light" href="{% url 'profile' %}">Settings</a>
                            </li>
                        {% endif %}
                        <li class="nav-item">
                          <a href="#" class="nav-link text-light" data-bs-toggle="modal" data-bs-target="#moreModal">
                            More
                          </a>
                        </li>

                    </ul>
                </div>
            </div>
        </nav>
    </div>

    {% block body %}{% endblock body %}
<!-- Floating Search Button -->
<div class="position-fixed bottom-0 end-0 p-4">
  <div class="fab-container">
    <!-- Main FAB -->
    <button id="mainFab" class="btn btn-success rounded-circle shadow-lg fab-main">
      🔍
    </button>

    <!-- Expanding options -->
    <div class="fab-options">
      <a href="{% url 'store_search' %}" 
         class="btn btn-light shadow-sm d-flex align-items-center gap-2 fab-option px-3 py-2 rounded-pill">
        <span class="fs-6 text-success fw-semibold">🏬 Stores</span>
      </a>
      <a href="{% url 'product_search' %}" 
         class="btn btn-light shadow-sm d-flex align-items-center gap-2 fab-option px-3 py-2 rounded-pill">
        <span class="fs-6 text-success fw-semibold">🛍 Products</span>
      </a>
    </div>
  </div>
</div>

<style>
  /* Container */
  .fab-container {
    position: relative;
  }

  /* Main FAB */
  .fab-main {
    width: 60px;
    height: 60px;
    font-size: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: transform 0.3s ease;
  }

  /* Options (hidden by default) */
  .fab-options {
    position: absolute;
    bottom: 70px;
    right: 0;
    display: flex;
    flex-direction: column;
    gap: 10px;
    opacity: 0;
    transform: translateY(20px);
    pointer-events: none;
    transition: all 0.3s ease;
  }

  /* Each option */
  .fab-option {
    border-radius: 50px;
    padding: 8px 16px;
    font-size: 15px;
    transition: background 0.2s;
  }
  .fab-option:hover {
    background: #e8f5e9;
  }

  /* When active */
  .fab-container.active .fab-options {
    opacity: 1;
    transform: translateY(0);
    pointer-events: auto;
  }
  .fab-container.active .fab-main {
    transform: rotate(45deg);
  }
</style>

<script>
  // Toggle FAB expansion
  document.addEventListener("DOMContentLoaded", () => {
    const fabContainer = document.querySelector(".fab-container");
    const mainFab = document.getElementById("mainFab");

    mainFab.addEventListener("click", () => {
      fabContainer.classList.toggle("active");
    });
  });
</script>


    <!-- Mobile Bottom Navigation -->
<div class="mobile-bottom-nav d-flex d-md-none">
    <a href="{% url 'home' %}" class="text-decoration-none">🏠<br>Home</a>
    <a href="{% url 'about' %}" class="text-decoration-none">ℹ️<br>About</a>
    {% if user_store %}
      <a href="{{ user_store.get_absolute_url }}" class="text-decoration-none">🛒<br>Store</a>
    {% endif %}
    {% if request.user.is_authenticated %}
        <a href="{% url 'profile' %}" class="text-decoration-none">⚙️<br>Settings</a>
    {% endif %}
    <a href="#" data-bs-toggle="modal" data-bs-target="#moreModal" class="text-decoration-none">⋯<br>More</a>
</div>

<!-- More Modal -->
<div class="modal fade" id="moreModal" tabindex="-1" aria-labelledby="moreModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="moreModalLabel">More Options</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body d-flex flex-column gap-2">
                <a href="{% url 'problem_solving' %}" class="btn btn-outline-success w-100">✅ Problem it Solves</a>
                <a href="{% url 'faqs' %}" class="btn btn-outline-success w-100">❓ FAQs</a>
                <a href="{% url 'money' %}" class="btn btn-outline-success w-100">⚡ 100K Blueprint</a>
            </div>
        </div>
    </div>
</div>



    <!-- JS -->
       <script>
    // Apply dark mode class on body if user saved it before
    if (localStorage.getItem('darkMode') === 'enabled') {
      document.body.classList.add('dark');
    }
  </script>
  <!-- ---------- Loader Script ---------- -->
  <script>
    const loader = document.getElementById("globalLoader");

    function showLoader() {
      loader.style.display = "flex";
    }
    function hideLoader() {
      loader.style.display = "none";
    }

    // Show loader on all form submits
    document.addEventListener("submit", function(e) {
      if (e.target.closest(".no-global-loader")) return; // 🚫 skip these forms
      showLoader();
    });


    // Show loader on all links/buttons with data-loading
    document.addEventListener("click", function(e) {
      const t = e.target.closest("[data-loading]");
      if (t) {
        showLoader();
      }
    });

    // Optional: intercept all fetch() globally
    const realFetch = window.fetch;
    window.fetch = async (...args) => {
      showLoader();
      try {
        return await realFetch(...args);
      } finally {
        hideLoader();
      }
    };

    // Hide loader on Escape (for debugging)
    window.addEventListener("keydown", e => {
      if (e.key === "Escape") hideLoader();
    });
  </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{% static 'js/bootstrap.js' %}"></script>
    <script src="{% static 'js/bootstrap.bundle.js' %}"></script>
</body>
</html>
